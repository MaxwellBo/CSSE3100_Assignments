% \RequirePackage[l2tabu, orthodox]{nag}

\documentclass{article}
\usepackage{fullpage}
\usepackage{oz}
\usepackage{definitions}
\usepackage{todonotes}

\title{\bf Assignment 1: Background theory}
\author{Maxwell Bo  ~~ 4392687}

\begin{document}
\maketitle

\begin{enumerate}
\item 
    \begin{enumerate}
    \item $y: [\ \true,\ (x = 0 \Rightarrow y = 0) \land (x \neq 0  \Rightarrow y = \frac{y_0}{x})\ ]$
    \item $y: [\ \true,\ (x = 0 \Rightarrow \true) \land (x \neq 0  \Rightarrow y = \frac{y_0}{x})\ ]$
    \item TODO
    \end{enumerate}

\item 
    \DERIVE
    \form{x,y:[\true,\ x = z^2 \land y = z^4]}
    \hint{\refsto} {Composition}
    \form{x,y:[\true,\ x = z^2]; x,y:[x = z^2,\ x = z^2 \land y = z^4]}
    \hint{\refsto} {Assignment: $\true \entails x = z^2 [x \backslash z^2]$}
    \form{x = z^2; x,y:[x = z^2,\ x = z^2 \land y = z^4]}
    \hint{\refsto} {Assignment: $x = z^2 \entails x = z^2 \land y = z ^ 4[y \backslash x^2]$}
    \form{x := z^2; y := x^2} 
    \ENDDERIVE

\item
    \begin{enumerate}
    \item Assuming
        \begin{eqnarray*}
            wp(y := 10,\ \true) & \equiv & \true[y \backslash 10]\\
                               & \equiv & \true
        \end{eqnarray*} 

        we can conclude that 

        \begin{eqnarray*}
            wp(\If~ (x > 0 ~\lor~ y < 10) \rightarrow y:= 10\ \Fi,\ \true) & \equiv & (x > 0 ~\lor~ y < 10) ~\land~ \\
                & & ((x > 0 ~\lor~ y < 10) \rightarrow wp(y := 10,\ \true))\\
            & \equiv & (x > 0 ~\lor~ y < 10) ~\land~ \true\\
            & \equiv & (x > 0 ~\lor~ y < 10)
        \end{eqnarray*}

        As $y < 10 \entails (x > 0 \lor y < 10)$, the Hoare Triple is $\true$.

    \item Assuming
        \begin{eqnarray*}
            wp(x := x + y,\ P[x \backslash x + y]) & \equiv & (P[x \backslash x + y])[x \backslash x + y]\\
                & \equiv & P[x \backslash (x + y) + y]\\
                & \equiv & P[x \backslash x + 2y]
        \end{eqnarray*}

        Using this

        \[ \hoare{\true[x \backslash x + 2y]}{x := x + y}{\true[x \backslash x + y]} \]

        holds but

        \begin{eqnarray*}
            \hoare{(x > 8)[x \backslash x + 2y]}{x := x + y}{(x > 8)[x \backslash x + y]} & \equiv & \hoare{x + 2y > 8}{x := x + y}{x + y > 8}
        \end{eqnarray*}

        does not. Therefore, the choice of $P$ determines the validity of the Hoare Triple, due to $P$ having arbitrary.
        Assuming that $P$ is quantified over all possible predicates, the Hoare Triple does not hold

    \end{enumerate}
\item
    \begin{enumerate}
    \item 
        \DERIVE
        \form{y:[y < 10, y > 0]}
        \hint{\refsto} {Selection: $y < 10 \entails (x > 0 \lor y < 10)$}
        \form{\If~ (x > 0 \lor y < 10) \rightarrow y:[(x > 0 \lor y < 10) \land (y < 10),\ y > 0]\ \Fi}
        \hint{\refsto} {Absorption 1: $(x > 0 \lor y < 10) \land (y < 10) = y < 10$}
        \form{\If~ (x > 0 \lor y < 10) \rightarrow y:[y < 10,\ y > 0]\ \Fi}
        \hint{\refsto} {Assignment: $y < 10 \entails y > 0[y \backslash 10]$}
        \form{\If~ (x > 0 \lor y < 10) \rightarrow y := 10\ \Fi}
        \ENDDERIVE

    \item 
        \DERIVE
        \form{y:[y < 10, y > 0]}
        \hint{\doesntrefsto} {Selection: $y < 10 \not\entails ((x > 0) \land (y < 10))$}

        \form{\If~ ((x > 0) \land (y < 10)) \rightarrow y:[((x > 0) \land (y < 10)) \land (y < 10),\ y > 0]\ \Fi}
        \ENDDERIVE
    \end{enumerate}
\item

    \[\forall S, B \cdot \Repeat\ S\ \Until\ B ~\equiv~ S; \Do\ \neg B \rightarrow S\ \Od\]
    $\therefore$
    \DERIVE
    \form{w:[P, Q]}
    \hint{\refsto} {Composition}
    \form{w: [P, I]; w: [I, Q]}
    \hint{\refsto} {Strengthen Postcondition: $I \land \neg(\neg B) \entails Q$}
    \form{w: [P, I]; w: P[I, I \land \neg(\neg B)]}
    \hint{\refsto} {Repetition}
    \form{w: [P, I]; \Do~ (\neg B) \rightarrow
 w:[I \land \neg B,\ I \land (0 \leqslant V < V_0)]\ \Od}
 \ENDDERIVE


\end{enumerate}

% Given 

% \[max(A,l,h,i) ~\defs~ \all j \in [l,h) \cdot (A_j \leq A_i) \land (l \leq i < h)\]   % \[ and \] tell Latex we are entering and leaving math mode

% suppose we wanted to show that the specification

% \[i,j:[A.len > 0, max(A,0,A.len,i)]\]

% is refined by

% \[i,j:=0,1;\\  % \\ adds a line break
% \begin{array}{l}
% \Do~ j < A.len \rightarrow\\
% \t1 \begin{array}{l}   % \t1 introduces a tab. The array environment allows us to write 
% \If~ A_j > A_i \rightarrow i:=j\\
% \Choice  A_j \leq A_i \rightarrow {\bf skip} \\
% \Fi; \\
% j:=j+1\\
% \end{array}\\
% \Od\\
% \end{array}\]

% Parts of the proof follow:

% \DERIVE
% \form{i,j:[A.len > 0, max(A,0,A.len,i)]}
% \hint{\refsto} {Strengthen post: $inv \land max(A,0,A.len,i) \entails max(A,0,A.len,i)$}  % $ changes between text and math mode
% \form{i,j:[A.len > 0, inv \land max(A,0,A.len,i)]}
% \hint{\equiv}{$max(A,0,A.len,i)$ is equivalent to $j = A.len$ when $inv$ is true}
% \form{i,j:[A.len > 0, inv \land j  = A.len]}
% \hint {\refsto} {Composition: mid predicate is $inv$}
% \form {i,j:[A.len > 0, inv]; i,j:[inv, inv \land j= A.len]}
% \hint {\refsto} {Assignment: $A.len > 0 \entails inv[i,j\backslash 0,1]$}
% \form { i,j:=0,1; i,j:[inv, inv \land j= A.len]}
% \ENDDERIVE
  
% The proof of the final step above is:

% \DERIVE
% \form{inv[i,j\backslash 0,1]}
% \hint{\equiv}{definition of $inv$}
% \form{max(A,0,j,i)[i,j\backslash 0,1]}
% \hint{\equiv}{apply substitution}
% \form{max(A,0,1,0)}
% \hint{\equiv}{since $A_0$ only element in $A_{[0,1)}$}
% \form{\true}
% \ENDDERIVE

% \pagebreak % forces a page break here

% Continuing the refinement:

% \DERIVE
% \form{i,j:[inv, inv \land j=A.len]}
% \hint{\refsto}{Repetition: $A.len-j$ is variant}
% \form{\begin{array}{l}   
% \Do~ j\neq A.len \rightarrow\\   
% \t1 i,j:[inv \land j< A.len, inv \land (0 \leq A.len-j < A.len-j_0)]\\  
% \Od \\
% \end{array}}
% \ENDDERIVE

% Here is another part of the proof involving other GCL notation:

% \DERIVE
% \form{i:[inv \land j< A.len, max(A,0,j+1,i)]}
% \hint{\refsto}{Selection: $P \entails A_i > A_j \lor A_j \leq A_i$, for any $P$}
% \form{\begin{array}{l}
% \If~ A_j > A_i \rightarrow i:[A_j > A_i \land inv \land j< A.len, max(A,0,j+1,i)]\\
% \Choice A_j \leq A_i \rightarrow i:[A_j \leq A_i \land inv \land j< A.len, max(A,0,j+1,i)]\\
% \Fi\\
% \end{array}}
% \hint{\sqsubseteq}{Assignment: $A_j > A_i \land inv \land j< A.len \entails max(A,0,j+1,i)[i\backslash j]$}
% \form{\begin{array}{l}
% \If~  A_j > A_i \rightarrow i:=j\\
% \Choice A_j \leq A_i \rightarrow i:[A_j \leq A_i \land inv \land j< A.len, max(A,0,j+1,i)]\\
% \Fi\\
% \end{array}}
% \hint{\refsto}{Skip: $A_j \leq A_i \land inv \land j< A.len \entails  max(A,0,j+1,i)$}
% \form{\begin{array}{l}
% \If~ A_j > A_i \rightarrow i:=j\\
% \Choice A_j \leq A_i \rightarrow {\Skip} \\
% \Fi\
% \end{array}}
% \ENDDERIVE
  
\end{document}

